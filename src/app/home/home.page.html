<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      registro de calificaciones
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">


  <div id="container" class="text-center">

    <ion-label style="display: inline-block;
<<<<<<< HEAD
      background-color: #ff0000;
      border: 2px solid #ff0000;
      color: #f60000;
      padding: 4px 8px;
      border-radius: 5px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(255, 0, 0, 0.2);
      box-shadow: 2px 2px 5px rgba(255, 0, 0, 0.1);">Agrega un estudiante nuevo con sus calificaciones</ion-label><br><br><br>
=======
      background-color: #87b68188;
      border: 2px solid #119b5b3a;
      color: #f021abd2;
      padding: 4px 8px;
      border-radius: 5px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(255, 0, 0, 0.301);
      box-shadow: 2px 2px 5px rgba(255, 0, 0, 0.233);">Agrega una pelicula nueva!</ion-label><br><br><br>
>>>>>>> 4d88c00ce1c038cb268c6edf3148b51ac9df052e

    <!--Inicio del formulario-->
    <form (submit)="addTask(); $event.preventDefault();">

      <ion-label class="text-gray-400 text-lg font-semibold">Nombre del estudiante:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newTaskName" name="taskName" placeholder="Nombre//" required /><br>

      <ion-label class="text-gray-400 text-lg font-semibold">apellido del estudiante:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newapellidoName" name="apellidoName" placeholder="apellido//" required /><br>

      <ion-label class="text-gray-400 text-lg font-semibold">Matricula del estudiante:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newMatriculaName" name="MatriculaName" placeholder="Matricula//" required /><br>


        <!--___________________________________________________________________________________________________________________________-->
      <ion-label class="text-gray-400 text-lg font-semibold">Calificacion de la materias</ion-label><br>



      <ion-label class="text-gray-400 text-lg font-semibold">DAMM:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newDAMMName" name="DAMMName" placeholder="DAMM//" required /><br>


        <ion-label class="text-gray-400 text-lg font-semibold">OCA:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newOCAName" name="OCAName" placeholder="OCA//" required /><br>

      <ion-label class="text-gray-400 text-lg font-semibold">MATE:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newMATEName" name="MATEName" placeholder="MATE//" required /><br>

      <ion-label class="text-gray-400 text-lg font-semibold">PMP:</ion-label><br>
      <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
        [(ngModel)]="newPMPName" name="PMPName" placeholder="PMP//" required /><br>

        <ion-label class="text-gray-400 text-lg font-semibold">M3D:</ion-label><br>
        <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" type="text"
          [(ngModel)]="newM3DName" name="M3DName" placeholder="M3D//" required /><br>


      <button
<<<<<<< HEAD
        class="focus:outline-none text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-900"
=======
        class="focus:outline-none text-white bg-red-700 hover:bg-purple-800 focus:ring-4 focus:ring-red-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900"
>>>>>>> 178e08c767ab710012e9655b44bcce7178b014c9
        type="submit">Agregar</button><br>

    </form>
    <br><br>
    <ion-label style="display: inline-block;
<<<<<<< HEAD
    background-color: #c37c7c;
    border: 2px solid #bf5d5d7d;
    color: #72b8c1;
    padding: 4px 8px;
    border-radius: 5px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(76, 0, 255, 0.2);
    box-shadow: 2px 2px 5px rgba(0, 0, 255, 0.1);">estudiantes Agregados</ion-label><br>
=======
    background-color: #87b68188;
      border: 2px solid #119b5b3a;
      color: #f021abd2;
    padding: 4px 8px;
    border-radius: 5px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(255, 0, 0, 0.308);
    box-shadow: 2px 2px 5px rgba(255, 0, 0, 0.226);">Peliculas agregadas</ion-label><br>
>>>>>>> 4d88c00ce1c038cb268c6edf3148b51ac9df052e

    <!-- Tabla de tareas -->
    <table>
      <thead>
        <tr>
          <th class="text-red-400 text-lg font-semibold">ID</th>
          <th class="text-red-400 text-lg font-semibold">Nombre</th>
<<<<<<< HEAD
          <th class="text-red-400 text-lg font-semibold">Director</th>
          <th class="text-red-400 text-lg font-semibold">enlace</th>
=======
          <th class="text-red-400 text-lg font-semibold">apellido</th>
          <th class="text-red-400 text-lg font-semibold">Matricula</th>
          <th class="text-red-400 text-lg font-semibold">DAMM</th>
          <th class="text-red-400 text-lg font-semibold">OCA</th>
          <th class="text-red-400 text-lg font-semibold">PMP</th>
          <th class="text-red-400 text-lg font-semibold">M3D</th>
>>>>>>> 178e08c767ab710012e9655b44bcce7178b014c9
          <th class="text-red-400 text-lg font-semibold">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of tasks$ | async">
          <td>{{ item.id }}</td>

          <!-- Mostrar input si se está editando, si no, mostrar el nombre -->
          <td *ngIf="editingTaskId === item.id; else viewMode">
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedTaskName" placeholder="Nuevo Nombre" />
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedapellidoName" placeholder="Nuevo apellido" />
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedMatriculaName" placeholder="Nueva Matricula" /> <!-- Agregar este input -->
<!--___________________________________________________________________________________________________________________________-->


              <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedDAMMName" placeholder="Nueva cal" />
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedOCAName" placeholder="Nueva cal" />
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedPMPName" placeholder="Nueva cal" /> <!-- Agregar este input -->
            <input class="border rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
              [(ngModel)]="editedM3DName" placeholder="Nueva cal" /> <!-- Agregar este input -->  

          </td>




          <ng-template #viewMode>
            <td>{{ item.name }}</td>
            <td>{{ item.apellido }}</td>
            <td>{{ item.Matricula }}</td>
            <td>{{ item.DAMMN }}</td>
            <td>{{ item.OCA }}</td>
            <td>{{ item.PMP }}</td>
            <td>{{ item.M3D }}</td>
          </ng-template>

          <td>
            <!-- Botón Editar / Guardar -->
            <button
              class="focus:outline-none text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900"
              style="margin: 5px;" *ngIf="editingTaskId !== item.id" (click)="startEdit(item)">Editar</button>
            <button
              class="focus:outline-none text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900"
              style="margin: 5px;" *ngIf="editingTaskId === item.id" (click)="saveEdit(item.id!)">Guardar</button>

            <!-- Botón Eliminar -->
            <button
              class="focus:outline-none text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900"
              [disabled]="!item.id" (click)="deleteTask(item.id!)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>

    <button (click)="onLogout()"
      class="focus:outline-none text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-semibold font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">
      Cerrar sesion</button>

  </div>
</ion-content>

<script>
  startEdit(task, Task); {
    this.editingTaskId = task.id;
    this.editedTaskName = task.name;
    this.editedAuthorName = task.author;
    this.editedLinkName = task.link; // Agregar el campo 'link'
  }

  saveEdit(taskId, string); {
    const name = this.editedTaskName.trim();
    const author = this.editedAuthorName.trim();
    const link = this.editedLinkName.trim();

    if (!name || !author || !link) {
      alert('Todos los campos son obligatorios');
      return;
    }

    this.taskService.updateTask(taskId, { name, author, link })
      .then(() => {
        console.log('Canción actualizada');
        this.editingTaskId = null;
        this.editedTaskName = '';
        this.editedAuthorName = '';
        this.editedLinkName = ''; // Limpiar el campo 'link'
      })
      .catch((err: unknown) => console.error('Error al actualizar canción:', err));
  }
</script>